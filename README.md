# ç¨³å®šå¸ç®¡ç†å¥—ä»¶

ç¨³å®šå¸ç®¡ç†å¹³å°åŒ…æ‹¬ä¸‰ä¸ªå®šåˆ¶å¼€å‘ç»„ä»¶

- ç®¡ç†å‘˜å¤šç­¾å·¥å…·
- åŠ©è®°è¯åˆ†ç‰‡ç®¡ç†å·¥å…·
- æ‰˜ç®¡è´¦æˆ·æœåŠ¡

## ç®¡ç†å‘˜å¤šç­¾å·¥å…·

ä¸€ä¸ªå®šåˆ¶å¼€å‘çš„Webé¡µé¢å·¥å…·ï¼Œç¨³å®šå¸ç®¡ç†å‘˜å¯ä»¥é€šè¿‡è¿™ä¸ªWebé¡µé¢å®žçŽ°å¯¹ç¨³å®šå¸åˆçº¦çš„å®‰å…¨ç®¡æŽ§ã€‚

```mermaid
graph TD
    subgraph VPN ["VPN ç½‘ç»œçŽ¯å¢ƒ"]
        subgraph "å®¢æˆ·ç«¯ (Client Side)"
            Browser["ðŸŒ å®¢æˆ·ç«¯æµè§ˆå™¨"]
            subgraph "Browser"
                WebApp["ðŸ’» Web é¡µé¢ (ç¨³å®šå¸ç®¡ç†)"]
                MetaMask["ðŸ¦Š MetaMask æ’ä»¶"]
                TronLink["ðŸ”— TronLink æ’ä»¶"]
            end
        end

        subgraph "æœåŠ¡ç«¯ (Server Side)"
            WebServer["ðŸ–¥ï¸ åº”ç”¨æœåŠ¡å™¨ (Web Server)"]
            subgraph "ç§æœ‰åŒºå—é“¾èŠ‚ç‚¹"
                EthRPC["[ä»¥å¤ªåŠç§æœ‰ RPC èŠ‚ç‚¹]"]
                TronRPC["[æ³¢åœºç§æœ‰ RPC èŠ‚ç‚¹]"]
            end
        end

        Browser -- "åŠ è½½ç®¡ç†é¡µé¢ (1)" --> WebServer
        WebApp -- "è¯·æ±‚ç­¾å (å¤šç­¾) (2)" --> MetaMask
        WebApp -- "è¯·æ±‚ç­¾å (å¤šç­¾) (2)" --> TronLink
        MetaMask -- "è¿”å›žç­¾åæ•°æ® (3)" --> WebApp
        TronLink -- "è¿”å›žç­¾åæ•°æ® (3)" --> WebApp
        WebApp -- "å‘é€å·²ç­¾åçš„äº¤æ˜“åˆ°æœåŠ¡ç«¯ (4)" --> WebServer
        WebServer -- "å¹¿æ’­äº¤æ˜“ (5)" --> EthRPC
        WebServer -- "å¹¿æ’­äº¤æ˜“ (5)" --> TronRPC
    end

    style VPN fill:#f0f7ff,stroke:#b3d1ff,stroke-width:2px,stroke-dasharray: 5 5
```

[source code](https://github.com/bitlistfun/usdv/tree/main/web)


## åŠ©è®°è¯åˆ†ç‰‡ç®¡ç†å·¥å…·

åˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯ç”±ç®¡ç†äººå‘˜å¯åŠ¨è¿è¡Œï¼ŒæœåŠ¡ç«¯ç”±è¿ç»´äººå‘˜å¯åŠ¨è¿è¡Œã€‚

åˆ†ä¸ºä¸¤ä¸ªè¿‡ç¨‹ï¼š
1. åˆ†å‘è¿‡ç¨‹ï¼šåˆ†å‘å¯†é’¥åŠ©è®°è¯ï¼ˆæœ‰ä¸”åªæœ‰ä¸€æ¬¡ï¼‰ï¼ŒæœåŠ¡ç«¯å¯åŠ¨åŽï¼Œå®¢æˆ·ç«¯éœ€è¦åœ¨ä¸€ä¸ªå¾ˆçŸ­çš„æ—¶é—´çª—å£å¯åŠ¨è¿›è¡Œå¯†é’¥åŠ©è®°è¯èŽ·å–ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯éƒ½éœ€è¦ä¿å­˜åŠ©è®°è¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯†é’¥åŠ©è®°è¯åˆ†å‘ç»™ä¸‰ä¸ªç®¡ç†äººå‘˜
2. å¯åŠ¨è¿‡ç¨‹ï¼šæœåŠ¡æ¯æ¬¡å¯åŠ¨åŽï¼ˆå…è®¸å¤šæ¬¡ï¼‰ï¼Œéƒ½éœ€è¦ç­‰å¾…æ‰€æœ‰å®¢æˆ·ç«¯å¯åŠ¨å¹¶è¾“å…¥æ­£ç¡®çš„åŠ©è®°è¯ï¼ŒæœåŠ¡ç«¯é€šè¿‡åŠ©è®°è¯ç”Ÿæˆå¯†é’¥å¯¹ï¼Œç”Ÿæˆçš„å¯†é’¥å¯¹ç”¨äºŽåŠ å¯†å’Œè§£å¯†æ•°æ®ã€‚

```mermaid
graph TD
    subgraph KMCæœåŠ¡ - å¯†é’¥ç®¡ç†é€»è¾‘
        direction LR

        A[å¼€å§‹] --> B{è¿ç»´å¯åŠ¨KMCæœåŠ¡ç«¯};

        subgraph "1. å¯†é’¥åˆ†å‘è¿‡ç¨‹ (æœ‰ä¸”åªæœ‰ä¸€æ¬¡)"
            direction TB
            B -- é¦–æ¬¡å¯åŠ¨/åˆ†å‘æ¨¡å¼ --> C{æœåŠ¡ç«¯è¿›å…¥çŸ­æ—¶é—´çª—å£};
            C -- çª—å£å¼€å¯ --> D["ç®¡ç†äººå‘˜å¯åŠ¨KMCå®¢æˆ·ç«¯ 1"];
            C --> E["ç®¡ç†äººå‘˜å¯åŠ¨KMCå®¢æˆ·ç«¯ 2"];
            C --> F["ç®¡ç†äººå‘˜å¯åŠ¨KMCå®¢æˆ·ç«¯ 3"];

            D --> G[å®¢æˆ·ç«¯ 1 èŽ·å–å¯†é’¥åŠ©è®°è¯];
            E --> H[å®¢æˆ·ç«¯ 2 èŽ·å–å¯†é’¥åŠ©è®°è¯];
            F --> I[å®¢æˆ·ç«¯ 3 èŽ·å–å¯†é’¥åŠ©è®°è¯];

            G --> J[å®¢æˆ·ç«¯ 1 ä¿å­˜åŠ©è®°è¯];
            H --> K[å®¢æˆ·ç«¯ 2 ä¿å­˜åŠ©è®°è¯];
            I --> L[å®¢æˆ·ç«¯ 3 ä¿å­˜åŠ©è®°è¯];

            J & K & L --> M{æ˜¯å¦æ‰€æœ‰å®¢æˆ·ç«¯å·²ä¿å­˜åŠ©è®°è¯?};
            M -- æ˜¯ --> N[å¯†é’¥åŠ©è®°è¯åˆ†å‘å®Œæˆ];
            M -- å¦ --> O[åˆ†å‘å¤±è´¥: å®¢æˆ·ç«¯æœªå…¨éƒ¨å®Œæˆ];

            C -- çª—å£å…³é—­/è¶…æ—¶ --> P[åˆ†å‘å¤±è´¥: çª—å£å·²è¿‡];
        end

        subgraph "2. KMCå¯åŠ¨è¿‡ç¨‹ (æ¯æ¬¡å¯åŠ¨)"
            direction TB
            B -- åŽç»­å¯åŠ¨/è¿è¡Œæ¨¡å¼ --> Q{æœåŠ¡ç«¯ç­‰å¾…å®¢æˆ·ç«¯å¯åŠ¨};
            Q --> R["ç®¡ç†äººå‘˜å¯åŠ¨KMCå®¢æˆ·ç«¯ 1"];
            Q --> S["ç®¡ç†äººå‘˜å¯åŠ¨KMCå®¢æˆ·ç«¯ 2"];
            Q --> T["ç®¡ç†äººå‘˜å¯åŠ¨KMCå®¢æˆ·ç«¯ 3"];

            R --> U[å®¢æˆ·ç«¯ 1 è¾“å…¥åŠ©è®°è¯];
            S --> V[å®¢æˆ·ç«¯ 2 è¾“å…¥åŠ©è®°è¯];
            T --> W[å®¢æˆ·ç«¯ 3 è¾“å…¥åŠ©è®°è¯];

            U & V & W --> X{æ‰€æœ‰å®¢æˆ·ç«¯åŠ©è®°è¯æ­£ç¡®?};
            X -- æ˜¯ --> Y[æœåŠ¡ç«¯é€šè¿‡åŠ©è®°è¯ç”Ÿæˆå¯†é’¥å¯¹];
            Y --> Z[å¯†é’¥å¯¹ç”¨äºŽæ•°æ®åŠ å¯†/è§£å¯†];
            Z --> AA[KMCæœåŠ¡æ­£å¸¸è¿è¡Œ];
            X -- å¦ --> AB[åŠ©è®°è¯é”™è¯¯ï¼Œç­‰å¾…é‡è¯•æˆ–å¤±è´¥];
        end

        N --> AA;
        P --> AC[ç»“æŸ];
        O --> AC;
        AA --> AC;
        AB --> AC;
    end
```

[source code](https://github.com/bitlistfun/usdv/tree/main/kmc/cmd)

## æ‰˜ç®¡è´¦æˆ·

æ¯ä¸ªå®¢æˆ·ç«¯é’±åŒ…å’Œæ‰˜ç®¡é’±åŒ…å­˜åœ¨ä¸€ä¸€å¯¹åº”å…³ç³»ï¼Œæä¾›æ‰˜ç®¡è´¦æˆ·çš„åˆ›å»ºå’Œç®¡ç†æœåŠ¡ã€‚æ‰˜ç®¡è´¦æˆ·çš„æ‰€æœ‰æ•°æ®åŠ å¯†å­˜å‚¨åœ¨æ•°æ®åº“ã€‚

```mermaid
graph TD
    A[ç”¨æˆ·é€šè¿‡æµè§ˆå™¨ + é’±åŒ…æ’ä»¶å‘èµ·æ‰˜ç®¡è´¦æˆ·ç®¡ç†æ“ä½œ] --> B{æ˜¯å¦ä¸ºåˆ›å»ºæ‰˜ç®¡è´¦æˆ·};
    B -- æ˜¯ --> C[å®¢æˆ·ç«¯ç”Ÿæˆæ‰˜ç®¡è´¦æˆ·å…¬é’¥];
    C --> D[å®¢æˆ·ç«¯è¯·æ±‚KMCæœåŠ¡ç«¯åˆ›å»ºæ‰˜ç®¡è´¦æˆ·];
    D --> E{KMCæœåŠ¡ç«¯æ˜¯å¦æ”¶åˆ°åˆ›å»ºè¯·æ±‚};
    E -- æ˜¯ --> F[KMCæœåŠ¡ç«¯ç”Ÿæˆæ‰˜ç®¡è´¦æˆ·ç§é’¥];
    F --> G[KMCæœåŠ¡ç«¯åŠ å¯†å­˜å‚¨æ‰˜ç®¡è´¦æˆ·ç§é’¥å’Œå…¬é’¥åˆ°æ•°æ®åº“];
    G --> H[KMCæœåŠ¡ç«¯è¿”å›žæ‰˜ç®¡è´¦æˆ·åˆ›å»ºæˆåŠŸå“åº”ç»™å®¢æˆ·ç«¯];
    H --> I[å®¢æˆ·ç«¯å­˜å‚¨æ‰˜ç®¡è´¦æˆ·å…¬é’¥å¹¶ä¸Žå½“å‰é’±åŒ…å…³è”];
    I --> J{æ‰˜ç®¡è´¦æˆ·åˆ›å»ºå®Œæˆ};
    B -- å¦ (ç®¡ç†) --> K[å®¢æˆ·ç«¯è¯·æ±‚KMCæœåŠ¡ç«¯æ‰§è¡Œæ“ä½œ];
    K --> L{KMCæœåŠ¡ç«¯æ˜¯å¦æ”¶åˆ°æ“ä½œè¯·æ±‚};
    L -- æ˜¯ --> M[KMCæœåŠ¡ç«¯æŸ¥è¯¢æ•°æ®åº“èŽ·å–æ‰˜ç®¡è´¦æˆ·åŠ å¯†åŽçš„ç§é’¥å’Œå…¬é’¥];
    M --> N[KMCæœåŠ¡ç«¯å¯¹ç§é’¥è¿›è¡Œè§£å¯†];
    N --> O{æ“ä½œç±»åž‹æ˜¯æŸ¥è¯¢ä½™é¢};
    O -- æ˜¯ --> P[KMCæœåŠ¡ç«¯è°ƒç”¨ä»¥å¤ªåŠæˆ–æ³¢åœºRPCèŠ‚ç‚¹æŸ¥è¯¢æ‰˜ç®¡è´¦æˆ·ä½™é¢];
    P --> Q[KMCæœåŠ¡ç«¯è¿”å›žæ‰˜ç®¡è´¦æˆ·ä½™é¢ç»™å®¢æˆ·ç«¯];
    Q --> R{æ‰˜ç®¡è´¦æˆ·ç®¡ç†å®Œæˆ};
    O -- å¦ (æ“ä½œæ˜¯äº¤æ˜“) --> S[å®¢æˆ·ç«¯æž„å»ºäº¤æ˜“ï¼Œå¹¶ä½¿ç”¨å®¢æˆ·ç«¯é’±åŒ…å¯¹äº¤æ˜“è¿›è¡Œéƒ¨åˆ†ç­¾å];
    S --> T[å®¢æˆ·ç«¯å°†éƒ¨åˆ†ç­¾åçš„äº¤æ˜“å‘é€ç»™KMCæœåŠ¡ç«¯];
    T --> U{KMCæœåŠ¡ç«¯æ˜¯å¦æ”¶åˆ°éƒ¨åˆ†ç­¾åçš„äº¤æ˜“};
    U -- æ˜¯ --> V[KMCæœåŠ¡ç«¯ä½¿ç”¨æ‰˜ç®¡è´¦æˆ·ç§é’¥å¯¹äº¤æ˜“è¿›è¡Œç­¾å];
    V --> W[KMCæœåŠ¡ç«¯å°†å®Œæ•´ç­¾åçš„äº¤æ˜“å¹¿æ’­åˆ°ä»¥å¤ªåŠæˆ–æ³¢åœºç½‘ç»œ];
    W --> X{äº¤æ˜“æ˜¯å¦å¹¿æ’­æˆåŠŸ};
    X -- æ˜¯ --> Y[KMCæœåŠ¡ç«¯æ›´æ–°æ•°æ®åº“ä¸­æ‰˜ç®¡è´¦æˆ·äº¤æ˜“è®°å½•];
    Y --> Z[KMCæœåŠ¡ç«¯è¿”å›žäº¤æ˜“å¹¿æ’­æˆåŠŸå“åº”ç»™å®¢æˆ·ç«¯];
    Z --> R;
    X -- å¦ --> AA[KMCæœåŠ¡ç«¯è¿”å›žäº¤æ˜“å¹¿æ’­å¤±è´¥å“åº”ç»™å®¢æˆ·ç«¯];
    AA --> R;
    L -- å¦ --> AB[KMCæœåŠ¡ç«¯è¿”å›žæ“ä½œå¤±è´¥å“åº”ç»™å®¢æˆ·ç«¯];
    AB --> R;
    E -- å¦ --> AC[KMCæœåŠ¡ç«¯è¿”å›žåˆ›å»ºå¤±è´¥å“åº”ç»™å®¢æˆ·ç«¯];
    AC --> J;
```

[source code](https://github.com/bitlistfun/usdv/tree/main/kmc)
